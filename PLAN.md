# План реализации

## Фаза 1: Настройка проекта и слой базы данных

### 1.1 Настройка окружения
- [ ] Создать виртуальное окружение
- [ ] Установить зависимости (PyQt5, requests/httpx, python-dotenv)
- [ ] Создать файл `.env.example` с именами переменных для API-ключей
- [ ] Создать `.gitignore` для исключения `.env` и `venv/`

### 1.2 Модуль базы данных (db.py)
- [ ] Создать модуль `db.py` с инициализацией базы данных
- [ ] Реализовать создание схемы базы данных:
  - [ ] Создать таблицу `prompts`
  - [ ] Создать таблицу `models`
  - [ ] Создать таблицу `results`
  - [ ] Создать таблицу `settings`
- [ ] Реализовать CRUD-операции для каждой таблицы:
  - [ ] `prompts`: create, read, update, delete, search, sort
  - [ ] `models`: create, read, update, delete, get_active_models
  - [ ] `results`: create, read, delete, search, sort
  - [ ] `settings`: get, set, get_all
- [ ] Добавить управление подключением к базе данных (context manager)
- [ ] Добавить обработку ошибок и логирование

---

## Фаза 2: Модули основной логики

### 2.1 Модуль моделей (models.py)
- [ ] Создать модуль `models.py` для управления моделями
- [ ] Реализовать класс `Model` со свойствами:
  - [ ] name, api_url, api_id, is_active
- [ ] Реализовать функции:
  - [ ] `get_active_models()` - получение активных моделей из БД
  - [ ] `load_model_config(model_id)` - загрузка конфигурации модели
  - [ ] `validate_model_config()` - валидация настроек модели

### 2.2 Модуль сети (network.py)
- [ ] Создать модуль `network.py` для API-запросов
- [ ] Реализовать абстракцию API-клиента:
  - [ ] Базовый класс для разных провайдеров API
  - [ ] Поддержка формата OpenAI API
  - [ ] Поддержка формата DeepSeek API
  - [ ] Поддержка формата Groq API
- [ ] Реализовать обработку запросов:
  - [ ] Загрузка API-ключей из файла `.env`
  - [ ] Отправка HTTP-запросов с правильными заголовками
  - [ ] Обработка таймаутов и повторов
  - [ ] Парсинг ответов
- [ ] Реализовать обработку ошибок:
  - [ ] Ошибки сети
  - [ ] Ошибки API (лимиты запросов, неверные ключи и т.д.)
  - [ ] Обработка таймаутов
- [ ] Добавить логирование запросов (опционально)

---

## Фаза 3: Реализация GUI

### 3.1 Структура главного окна (main.py)
- [ ] Создать главное окно с PyQt5
- [ ] Разработать макет:
  - [ ] Верхняя секция: область ввода промта
  - [ ] Средняя секция: таблица результатов
  - [ ] Нижняя секция: кнопки действий
- [ ] Реализовать строку меню:
  - [ ] Меню Файл (экспорт, настройки)
  - [ ] Меню Модели (управление моделями)
  - [ ] Меню Промты (просмотр сохраненных промтов)
  - [ ] Меню Справка

### 3.2 Секция ввода промта
- [ ] Создать виджет текстового ввода для новых промтов
- [ ] Создать выпадающий список/combobox для выбора сохраненных промтов
- [ ] Добавить кнопку "Загрузить промт"
- [ ] Добавить кнопку "Отправить" для запуска запросов
- [ ] Добавить поле ввода тегов (опционально)

### 3.3 Таблица результатов
- [ ] Создать QTableWidget для отображения результатов
- [ ] Настроить столбцы:
  - [ ] Название модели
  - [ ] Текст ответа
  - [ ] Чекбокс (выбрано)
- [ ] Реализовать временную таблицу в памяти (не в БД)
- [ ] Добавить функциональность сортировки таблицы
- [ ] Добавить функциональность поиска/фильтрации таблицы
- [ ] Стилизовать таблицу для читаемости

### 3.4 Кнопки действий
- [ ] Кнопка "Сохранить выбранные" - сохранить отмеченные результаты в БД
- [ ] Кнопка "Очистить" - очистить временную таблицу
- [ ] Кнопка "Экспорт" - экспортировать выбранные результаты
- [ ] Кнопка "Новый запрос" - очистить и начать новый запрос

---

## Фаза 4: Интеграция и рабочий процесс

### 4.1 Рабочий процесс промта
- [ ] Реализовать обработку ввода промта:
  - [ ] Создание нового промта
  - [ ] Выбор сохраненного промта
  - [ ] Загрузка промта из базы данных
- [ ] Сохранять новые промты в базу данных при отправке
- [ ] Очищать временную таблицу результатов при новом промте

### 4.2 Рабочий процесс запросов
- [ ] Реализовать асинхронную/синхронную отправку запросов:
  - [ ] Получить активные модели из базы данных
  - [ ] Отправить промт в каждую модель
  - [ ] Обрабатывать ответы по мере поступления
  - [ ] Обновлять таблицу результатов в реальном времени
- [ ] Показывать индикаторы загрузки во время запросов
- [ ] Обрабатывать ошибки корректно (показывать в таблице или диалоге ошибок)

### 4.3 Управление результатами
- [ ] Реализовать обработку чекбоксов в таблице результатов
- [ ] Реализовать функциональность "Сохранить выбранные":
  - [ ] Получить выбранные строки (отмеченные чекбоксы)
  - [ ] Сохранить в таблицу `results` с prompt_id и model_id
  - [ ] Очистить временную таблицу после сохранения
- [ ] Реализовать функциональность "Очистить"

---

## Фаза 5: Дополнительные функции

### 5.1 Поиск и сортировка
- [ ] Реализовать функциональность поиска:
  - [ ] Поиск в таблице промтов
  - [ ] Поиск в таблице результатов
  - [ ] Поиск по тегам
- [ ] Реализовать функциональность сортировки:
  - [ ] Сортировка по дате
  - [ ] Сортировка по названию модели
  - [ ] Сортировка по тексту промта

### 5.2 Функциональность экспорта
- [ ] Реализовать экспорт в Markdown:
  - [ ] Формат: название модели, промт, ответ
  - [ ] Включить метаданные (дата, теги)
- [ ] Реализовать экспорт в JSON:
  - [ ] Включить все поля результата
  - [ ] Опция красивого форматирования
- [ ] Добавить диалог экспорта для выбора формата

### 5.3 UI управления моделями
- [ ] Создать диалог для добавления/редактирования моделей:
  - [ ] Поля формы: name, api_url, api_id, is_active
  - [ ] Валидация
  - [ ] Сохранение в базу данных
- [ ] Создать представление списка моделей
- [ ] Добавить функциональность включения/отключения модели

### 5.4 Управление настройками
- [ ] Создать диалог настроек
- [ ] Реализовать сохранение настроек:
  - [ ] Настройки таймаута
  - [ ] Настройки повторов
  - [ ] Предпочтения формата экспорта
  - [ ] Предпочтения темы интерфейса
- [ ] Загружать настройки при запуске приложения

---

## Фаза 6: AI-ассистент для улучшения промтов

### 6.1 Модуль улучшения промтов (prompt_improver.py)
- [ ] Создать модуль `prompt_improver.py` для логики улучшения промтов
- [ ] Реализовать класс `PromptImprover`:
  - [ ] Метод `improve_prompt(original_prompt, model_id)` - отправка запроса на улучшение
  - [ ] Метод `generate_variants(original_prompt, model_id)` - генерация вариантов переформулировки
  - [ ] Метод `adapt_for_model_type(prompt, model_type)` - адаптация под тип модели (код, анализ, креатив)
- [ ] Реализовать формирование промта для AI-ассистента:
  - [ ] Шаблон запроса на улучшение промта
  - [ ] Шаблон запроса на генерацию вариантов
  - [ ] Шаблон запроса на адаптацию под тип модели
- [ ] Интеграция с существующим модулем `network.py`:
  - [ ] Использование OpenRouter-клиента для отправки запросов
  - [ ] Выбор модели для улучшения (из списка активных моделей)
  - [ ] Обработка ответов от AI-ассистента
- [ ] Реализовать парсинг ответа:
  - [ ] Извлечение улучшенной версии промта
  - [ ] Извлечение 2-3 вариантов переформулировки
  - [ ] Обработка структурированного ответа (JSON или текст)
- [ ] Добавить обработку ошибок:
  - [ ] Ошибки сети при запросе к AI
  - [ ] Некорректные ответы от модели
  - [ ] Таймауты запросов

### 6.2 UI компоненты для улучшения промтов
- [ ] Добавить кнопку "Улучшить промт" в секцию ввода промта:
  - [ ] Разместить рядом с полем ввода промта
  - [ ] Добавить иконку (опционально)
  - [ ] Подключить обработчик нажатия
- [ ] Создать диалоговое окно/панель `PromptImprovementDialog`:
  - [ ] Отображение исходного промта (read-only)
  - [ ] Область для улучшенной версии промта
  - [ ] Список альтернативных вариантов (2-3 варианта)
  - [ ] Радиокнопки или вкладки для выбора варианта
  - [ ] Кнопка "Подставить в поле ввода" для выбранного варианта
  - [ ] Кнопка "Отмена" для закрытия диалога
- [ ] Реализовать выбор модели для улучшения:
  - [ ] Выпадающий список с активными моделями
  - [ ] Возможность выбора типа адаптации (код, анализ, креатив, общее улучшение)
  - [ ] Разместить в диалоге или в главном окне рядом с кнопкой
- [ ] Добавить индикатор загрузки:
  - [ ] Показывать во время запроса к AI
  - [ ] Блокировать повторные запросы во время обработки
- [ ] Реализовать функциональность "Подставить в поле ввода":
  - [ ] Получить выбранный вариант из диалога
  - [ ] Вставить текст в поле ввода промта в главном окне
  - [ ] Закрыть диалог после вставки

### 6.3 Интеграция с основным интерфейсом
- [ ] Подключить модуль `prompt_improver.py` к `main.py`:
  - [ ] Импортировать класс `PromptImprover`
  - [ ] Создать экземпляр класса при инициализации главного окна
- [ ] Реализовать обработчик кнопки "Улучшить промт":
  - [ ] Проверить наличие текста в поле ввода промта
  - [ ] Получить выбранную модель для улучшения
  - [ ] Вызвать метод улучшения промта
  - [ ] Открыть диалог с результатами
- [ ] Обработать случай пустого промта:
  - [ ] Показать предупреждение, если поле ввода пустое
  - [ ] Предложить использовать сохраненный промт
- [ ] Добавить обработку ошибок в UI:
  - [ ] Показывать сообщения об ошибках в диалоге
  - [ ] Логировать ошибки для отладки

### 6.4 Дополнительные возможности
- [ ] Реализовать сохранение улучшенных промтов:
  - [ ] Опция сохранения улучшенной версии в базу данных
  - [ ] Связь с исходным промтом (parent_id или теги)
- [ ] Добавить историю улучшений:
  - [ ] Сохранение истории улучшений промта
  - [ ] Возможность просмотра предыдущих версий
- [ ] Реализовать настройки улучшения:
  - [ ] Выбор модели по умолчанию для улучшения
  - [ ] Настройка количества вариантов (2-3)
  - [ ] Предпочтения по типу адаптации
  - [ ] Сохранение в таблицу `settings`

---

## Фаза 7: Тестирование и доработка

### 7.1 Модульное тестирование
- [ ] Тестировать операции с базой данных
- [ ] Тестировать загрузку моделей
- [ ] Тестировать обработку API-запросов
- [ ] Тестировать обработку ошибок

### 7.2 Интеграционное тестирование
- [ ] Тестировать полный рабочий процесс:
  - [ ] Создать промт → отправить в модели → сохранить результаты
  - [ ] Загрузить сохраненный промт → отправить → сохранить
- [ ] Тестировать граничные случаи:
  - [ ] Нет активных моделей
  - [ ] Ошибки API
  - [ ] Сбои сети
  - [ ] Пустые ответы

### 7.3 Улучшение UI/UX
- [ ] Улучшить сообщения об ошибках
- [ ] Добавить подсказки
- [ ] Улучшить стилизацию таблицы
- [ ] Добавить горячие клавиши
- [ ] Тестировать на разных размерах экрана

### 7.4 Документация
- [ ] Обновить README.md с инструкциями по использованию
- [ ] Документировать настройку API-ключей
- [ ] Документировать схему базы данных
- [ ] Добавить комментарии в код

---

## Фаза 8: Опциональные улучшения

### 8.1 Расширенные функции
- [ ] Логирование запросов в базу данных
- [ ] Инструменты сравнения ответов
- [ ] Пакетная обработка промтов
- [ ] Метрики производительности моделей
- [ ] Кэширование ответов

### 8.2 Улучшения интерфейса
- [ ] Переключение темной/светлой темы
- [ ] Настраиваемые столбцы таблицы
- [ ] Предпросмотр/развертывание ответа
- [ ] Функциональность копирования в буфер обмена

---

## Резюме порядка реализации

1. **Слой базы данных** (db.py) - Основа
2. **Модуль моделей** (models.py) - Структуры данных
3. **Модуль сети** (network.py) - Коммуникация с API
4. **Базовый GUI** (main.py) - Каркас пользовательского интерфейса
5. **Основной рабочий процесс** - Интеграция всех компонентов
6. **Дополнительные функции** - Поиск, сортировка, экспорт
7. **AI-ассистент для улучшения промтов** - Функция улучшения и переформулировки промтов
8. **Тестирование и полировка** - Обеспечение качества
9. **Опциональные улучшения** - Расширенные функции и улучшения интерфейса

## Примечания

- Начать с минимально жизнеспособного продукта (MVP): базовый промт → запрос → результаты → сохранение
- Добавлять функции постепенно
- Тестировать каждую фазу перед переходом к следующей
- Поддерживать модульность кода и хорошую документацию
