# Схема базы данных

## Обзор
ChatList использует базу данных SQLite для хранения промтов, конфигурации моделей, сохраненных результатов и настроек приложения.

## Таблицы

### 1. prompts
Хранит промты пользователя с метаданными.

| Поле | Тип | Ограничения | Описание |
|------|-----|-------------|----------|
| id | INTEGER | PRIMARY KEY AUTOINCREMENT | Уникальный идентификатор |
| date | TEXT | NOT NULL | Дата и время создания промта (формат ISO) |
| prompt | TEXT | NOT NULL | Текст промта |
| tags | TEXT | NULL | Теги через запятую для категоризации |

**Индексы:**
- Индекс по `date` для сортировки
- Индекс по `tags` для фильтрации

---

### 2. models
Хранит конфигурацию для AI-моделей/нейросетей.

| Поле | Тип | Ограничения | Описание |
|------|-----|-------------|----------|
| id | INTEGER | PRIMARY KEY AUTOINCREMENT | Уникальный идентификатор |
| name | TEXT | NOT NULL UNIQUE | Отображаемое название модели (например, "GPT-4", "Claude 3") |
| model_id | TEXT | NOT NULL | Идентификатор модели для использования в API запросах (например, "openai/gpt-4") |
| api_url | TEXT | NOT NULL | URL API-эндпоинта |
| api_id | TEXT | NOT NULL | Имя переменной в файле .env, содержащей API-ключ |
| is_active | INTEGER | NOT NULL DEFAULT 1 | Статус активности (1 = активна, 0 = неактивна) |

**Индексы:**
- Индекс по `is_active` для фильтрации активных моделей
- Уникальное ограничение на `name`

**Примечания:**
- API-ключи хранятся в файле `.env`, а не в базе данных
- `api_id` ссылается на имя переменной окружения (например, "OPENAI_API_KEY")
- `name` - это отображаемое название для пользователя
- `model_id` - это идентификатор модели, который используется в API запросах (например, "openai/gpt-4" для OpenRouter)

---

### 3. results
Хранит сохраненные результаты ответов моделей.

| Поле | Тип | Ограничения | Описание |
|------|-----|-------------|----------|
| id | INTEGER | PRIMARY KEY AUTOINCREMENT | Уникальный идентификатор |
| prompt_id | INTEGER | NOT NULL | Внешний ключ на prompts.id |
| model_id | INTEGER | NOT NULL | Внешний ключ на models.id |
| response_text | TEXT | NOT NULL | Текст ответа модели |
| saved_date | TEXT | NOT NULL | Дата и время сохранения результата (формат ISO) |
| metadata | TEXT | NULL | Дополнительные JSON-метаданные (использованные токены, задержка и т.д.) |

**Индексы:**
- Индекс по `prompt_id` для фильтрации по промту
- Индекс по `model_id` для фильтрации по модели
- Индекс по `saved_date` для сортировки
- Ограничение внешнего ключа: `prompt_id` REFERENCES `prompts(id)`
- Ограничение внешнего ключа: `model_id` REFERENCES `models(id)`

---

### 4. settings
Хранит настройки приложения.

| Поле | Тип | Ограничения | Описание |
|------|-----|-------------|----------|
| key | TEXT | PRIMARY KEY | Ключ настройки (уникальный идентификатор) |
| value | TEXT | NOT NULL | Значение настройки (хранится как текст, парсится при необходимости) |
| updated_at | TEXT | NOT NULL | Временная метка последнего обновления (формат ISO) |

**Общие настройки:**
- `default_timeout` - Таймаут запроса в секундах
- `max_retries` - Максимальное количество попыток повтора
- `export_format` - Формат экспорта по умолчанию (markdown/json)
- `theme` - Предпочтение темы интерфейса

---

## Инициализация базы данных

База данных должна быть инициализирована с:
1. Настройками по умолчанию в таблице `settings`
2. Примерными моделями в таблице `models` (опционально, можно добавить через UI)
3. Включенными ограничениями внешних ключей

## Связи

```
prompts (1) ──< (много) results
models (1) ──< (много) results
```

Каждый результат связан с одним промтом и одной моделью.
